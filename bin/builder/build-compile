#!/usr/bin/env build

# FIXME the CHOST is part of the BUILDER environment and should be handled
# accordingly
CHOST="i586-uplogix-linux-gnu"
CROSS_COMPILE="${CHOST}-"
ARCH="x86"
export ARCH CROSS_COMPILE CHOST

PATH="${BUILDER_SYSROOT}/usr/bin:${PATH}"
export PATH

pkg_compile()
{
	# FIXME these defaults need moved elsewhere
	if [ -f "configure" ]; then
		./configure	--host="${CHOST}"			\
				--prefix="/usr" --mandir=/usr/share/man	\
				--docdir=/usr/share/doc			\
				--sysconfdir=/etc			\
				${CONFIG_OPTS}
	fi

	# FIXME we need a bunch of make options in here
	make ${MAKE_OPTS} && make DESTDIR="${D}" install
}

import "${1}"

[ -d "${D}" ] || mkdir -p "${D}"
[ -d "${S}" ] || mkdir -p "${S}"
[ -d "${L}" ] || mkdir -p "${L}"
if [ -f "${L}/compile.log" ]; then
	rm "${L}/compile.log" || exit 1
fi
touch "${L}/compile.log"

(cd "${S}" && pkg_compile > "${L}/compile.log" 2>&1 && date --utc > ${L}/.compiled)

# vim: filetype=sh
